@page "/favourites"
@using Data
@using StockTracker.Data;
@inject StockService stockService;

@if (stocks == null)
{
  <p><em>Loading...</em></p>
}
else
{
  <table class='table table-hover'>
    <thead>
      <tr>
        <th>Ticker</th>
        <th>UserId</th>
      </tr>
    </thead>
    <tbody>
      @foreach (var item in stocks)
        {
          <tr>
            <td>@item.ticker</td>
            <td>
              <button>View</button>
              <button>Delete</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
}

@code {
  List<Stock>? stocks;
  [CascadingParameter] protected Task<AuthenticationState>? AuthStat { get; set; }
  String? Ticker;
  String? UserId;

  protected override async Task OnInitializedAsync()
  {
    await load();
  }

  protected async Task load()
  {
    stocks = await stockService.GetStocksAsync();
  }

  protected async Task AddStock()
  {
    var user = (await AuthStat).User;
    UserId = user.FindFirst(u => u.Type.Contains("nameidentifier"))?.Value!;

    Stock s = new Stock()
    {
      ticker = Ticker,
      userId = UserId
    };

    await stockService.InsertStockAsync(s);
    await load();
  }
}
